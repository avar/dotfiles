[user]
	name = Ævar Arnfjörð Bjarmason
	email = avarab@gmail.com
[github]
	login = avar
[include]
	path = ~/.gitconfig.d/github-token
[includeIf "gitdir:~/g/perl/"]
	path = ~/.gitconfig.d/user-perl
[color]
	ui = auto

;; Don't be so invasive about coloring ^M when I'm editing files that
;; are supposed to have \r\n.
[color "diff"]
	whitespace = 0

[alias]
        ;; Invoke an arbitrary program with git config. See
        ;; https://lore.kernel.org/git/87h7oswepj.fsf@evledraar.gmail.com/
        sh = !sh
	;; Debugging (see GIT_* vars)
	env = !env --null | perl -n0E 'say if /^GIT/'

	;; Lazyness
	st = status --short
	ci = commit
	co = checkout
	sm = submodule
	chrp = cherry-pick

	;; Parellel fetch
	pfetch = !parallel 'git -c gc.auto=0 fetch {}' ::: $(git remote) && git gc --auto

	;; Submodules
	sm-init = !git submodule update --init
	; Try to update all the submodules, doing some guesswork to get branch names
	sm-pull-all = !git submodule foreach 'git checkout $(NAME=$name git sm-mainbranch) && git pull'
	; Manually specify a branch from the main config, or try to guess it
	sm-mainbranch = !git config --file ../.gitmodules submodule.$NAME.branch || git describe --all --always | sed 's!^heads/!!'

	;; Diff
	di     = diff -M -p --stat
	diw    = !git di -w
	diww   = !git diw --word-diff=color
	diwwd  = !git diww --word-diff-regex=.
	dis    = !git di --staged
	disw   = !git diw --staged
	disww  = !git diww --staged
	diswwd = !git diwwd --staged
	;; Show
	s      = show -M -p --stat
	sw     = !git s -w
	sww    = !git sw --word-diff=color
	swwd   = !git sww --word-diff-regex=.

	;; Handy tools
	review = "!f() { for rev in $(git rev-list --reverse $@); do LESS='--IGNORE-CASE --LONG-PROMPT --QUIET --chop-long-lines --RAW-CONTROL-CHARS' git show --stat -p -M $rev; done; }; f"

        ;; Git doesn't have a one-shot command to copy a branch & its
        ;; config to a new location.
        cp-branch = "!f() { git branch -c $1 $2 && git checkout $2; }; f"

	;; Working on git.git & other things using "reference"
        reference = show -s --pretty=reference
	git-commit-summary = !git reference

	;; Like push but harder
	thrust = "!f() { until (sleep 0.5 && git push); do git pull --rebase; done; }; f"
[push]
	default = upstream
[pull]
	rebase = true
[sendemail]
	smtpserver = smtp.gmail.com
	smtpEncryption = ssl
	smtpuser = avarab@gmail.com
	confirm = always
[rebase]
	autosquash = true
	;; Show stat output on rebase to show what changed
	stat = true
[http]
	sslVerify = false
[grep]
	patternType = perl
[log]
	;; Show tags and other references in "git log"
	decorate = short
	;; Abbreviate commits by default. I.e. don't show a full SHA1
	abbrevCommit = true
[merge]
	;; Have "git merge" do what "git pull" would have done
	defaultToUpstream = true
[annex]
	backends = SHA256E SHA256
[help]
	autocorrect = 0
[fetch]
	output = compact
[core]
	untrackedCache = true
	splitIndex = false
[checkout]
	defaultRemote = origin
[diff]
	indentHeuristic = true
	colorMoved = true
[status]
	showStash = true
[commit]
        # See https://public-inbox.org/git/20190520182353.22221-1-matheus.bernardino@usp.br/
	verbose = true
[tag]
	sort = version:refname
[rerere]
	enabled = true
	autoUpdate = true
[mailinfo]
	scissors = true
[credential]
	helper = /usr/share/doc/git/contrib/credential/gnome-keyring/git-credential-gnome-keyring
