source /home/avar/.screenrc
source /home/aearnfjord/.screenrc

sessionname dev-core-git

screen -t g:m:0 bash
stuff "cd ~/g/git.meta^M"
stuff "remove_from_path \$(dirname $(which git))^M"
stuff "# git pfetch^M"

screen -t g:b:0 bash
stuff "cd ~/g/git.meta^M"
stuff "remove_from_path \$(dirname $(which git))^M"
stuff "cat make-install-avargit.sh^M"
stuff "git version^M"


screen -t g:2 bash
stuff "cd ~/g/git^M"

screen -t g:3 bash
stuff "cd ~/g/git^M"

screen -t g:4 bash
stuff "cd ~/g/git^M"

screen -t p:0 bash
stuff "cd ~/g/git^M"
stuff "cd t/perf^M"
stuff "# GIT_PERF_LARGE_REPO=~/g/linux ./run p7820-grep-engines.sh^M"
# GIT_PERF_REPEAT_COUNT=30 GIT_PERF_LARGE_REPO=~/g/linux GIT_PERF_MAKE_OPTS='-j8 USE_LIBPCRE1=Y CFLAGS=-O3 LIBPCREDIR=/home/avar/g/pcre/inst' ./run HEAD
# GIT_PERF_REPEAT_COUNT=5 GIT_PERF_REPO=~/g/sha1collisiondetection/ GIT_PERF_MAKE_OPTS='-j8 USE_LIBPCRE=Y CFLAGS=-O3 LIBPCREDIR=/home/avar/g/pcre2/inst' ./run origin/next HEAD p4209-pickaxe.sh

screen -t c:d:r bash
stuff "cd ~/g/git^M"
stuff "# git rebase -i --exec '~/g/git.meta/config.mak.sh && time make TAGS all check-docs && (cd t && make GIT_PROVE_OPTS=\"--timer\" T=\"$(dedup t000[0-9]*.sh)\")'^M"

screen -t c:d bash
stuff "cd ~/g/git^M"
stuff "remove_from_path \$(dirname $(which git))^M"
stuff "# ~/g/git.meta/config.mak.sh && time make TAGS all check-docs^M"
stuff "# ~/g/git.meta/config.mak.sh && time make TAGS all check-docs^M"

screen -t g:hf bash
stuff "cd ~/g/git^M"
stuff "# git hyperfine --ghf-worktree-xargs git worktree remove --force^M"
stuff "# git hyperfine  -L rev origin/master,HEAD~0 -s 'make' 'make T=t0001-init.sh'^M"
stuff "# git hyperfine  -L rev HEAD~1,HEAD~0 -s 'make' 'make T=t0001-init.sh'^M"

screen -t t:0 bash
stuff "cd ~/g/git^M"
stuff "cd t^M"
stuff "# ~/g/git.meta/config.mak.sh && time NO_SVN_TESTS=1 GIT_TEST_HTTPD=0 make GIT_PROVE_OPTS=\"--timer --state=failed,slow,save\"^M"
stuff "# ~/g/git.meta/config.mak.sh && time GIT_TEST_HTTPD=1 GIT_TEST_PASSING_SANITIZE_LEAK= make GIT_PROVE_OPTS=\"--timer --state=failed,slow,save\"^M"

screen -t t:1 bash
stuff "cd ~/g/git^M"
stuff "cd t^M"
stuff "# ~/g/git.meta/config.mak.sh && time make GIT_PROVE_OPTS=\"--timer\" T=\"$(dedup $(echo t[0-9]*{grep,log}*.sh))\"^M"
stuff "# ~/g/git.meta/config.mak.sh && time make GIT_PROVE_OPTS=\"--timer\" T=\"$(dedup $(echo t[0-9]*{bundle,protocol,serve,pack,remote,receive}*.sh))\""

screen -t t:2 bash
stuff "cd ~/g/git^M"
stuff "cd t^M"
stuff "# ./t7810-grep.sh -v -i"

screen -t a:runner bash
stuff "cd ~/g/actions-runner^M"
stuff "./run.sh^M"

screen -t se:new bash
stuff "cd ~/g/git^M"
stuff "remove_from_path \$(dirname $(which git))^M"
stuff "# gpp -F --fpa='--subject-prefix=\"PATCH\"' --sea='--cc=\"Junio C Hamano <gitster@pobox.com>\"' --no-send^M"
stuff "# gpp -F --fpa='--subject-prefix=\"PATCH\" --cover-letter' --sea='--cc=\"Junio C Hamano <gitster@pobox.com>\" --cc=\"Jeff King <peff@peff.net>\"' --no-send^M"
stuff "# gpp -F --fpa='--cover-letter --subject-prefix=\"PATCH v2\" --range-diff=avar/XXX --in-reply-to=\"<>\"' --sea='--cc=\"Junio C Hamano <gitster@pobox.com>\"' --no-send^M"

screen -t ml:r
stuff "cd ~/g/git-ml^M"
stuff "while true; do if test \$(find ~/g/git -type f -mmin -1440 | wc -l) -gt 0; then git pull; else echo too old; fi ; date ; sleep 300; done^M"

screen -t ml:sh:0
stuff "cd ~/g/git-ml^M"
stuff "git --no-pager log --oneline -10^M"

screen -t r:pcre1
stuff "cd ~/g/pcre^M"
stuff "git svn rebase^M"
stuff "test -f RunTest && git clean -dxf; ./autogen.sh; CXXFLAGS='-O3 -g' CFLAGS='-O3 -g' ./configure --prefix=\$PWD/inst --enable-jit --enable-utf --enable-unicode-properties && time make install"

screen -t r:pcre2
stuff "cd ~/g/pcre2^M"
stuff "git svn rebase^M"
stuff "# test -f RunTest && git clean -dxf; ./autogen.sh; CXXFLAGS='-O3 -g' CFLAGS='-O3 -g' ./configure --prefix=\$PWD/inst --enable-jit --enable-utf && time make install"
stuff "# test -f RunTest && git clean -dxf; ./autogen.sh; CXXFLAGS='-O3 -g' CFLAGS='-O3 -g' ./configure --prefix=\$PWD/inst --enable-jit --enable-utf && time make install"

screen -t r:curl
stuff "cd ~/g/curl^M"
stuff "git fetch^M"
stuff "# git checkout curl-7_39_0^M"
stuff "# (git clean -dxf && autoreconf -fi && ./configure --with-openssl --prefix=/home/avar/local)^M"
stuff "# make -j \$(nproc)^M"
stuff "# make test^M"
stuff "# make install^M"

screen -t r:gnulib
stuff "cd ~/g/gnulib^M"
stuff "git fetch^M"

screen -t r:sha1dc
stuff "cd ~/g/sha1collisiondetection^M"
stuff "git fetch^M"

# GCC farm boxes @ https://cfarm.tetaneutral.net/machines/list/
screen -t t:gl:ci:sh:0
stuff "cd ~/g/git-gitlab-ci^M"
stuff "grep '\^#' ~/g/git-gitlab-ci/ci/gitlab/run-on-gcc-farm.sh^M"

screen -t t:gl:ci:sh:1
stuff "cd ~/g/git-gitlab-ci^M"
stuff "grep '\^#' ~/g/git-gitlab-ci/ci/gitlab/run-on-gcc-farm.sh^M"

# AIX 7.1
screen -t t:gl:run:gcc111:aix71
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "export OPT_TESTS='t[0-9]*.sh'^M"
stuff "# time OPT_DEBUG= OPT_JOBS=3 OPT_JOB_NAME=gcc111 OPT_REVISION=HEAD OPT_TESTS=\"t[0-9]*.sh\" ~/g/git-gitlab-ci/ci/gitlab/run-on-gcc-farm.sh^M"
stuff "export OPT_TESTS='t1450-fsck.sh t4212-log-corrupt.sh'^M"
stuff "export OPT_TESTS='t1061-object-envelope-time.sh'^M"

# AIX 7.2
screen -t t:gl:run:gcc119:aix72
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "export OPT_TESTS='t[0-9]*.sh'^M"
stuff "# time OPT_DEBUG= OPT_JOBS=3 OPT_JOB_NAME=gcc119 OPT_REVISION=HEAD OPT_TESTS=\"t[0-9]*.sh\" ~/g/git-gitlab-ci/ci/gitlab/run-on-gcc-farm.sh^M"
stuff "export OPT_TESTS='t1450-fsck.sh t4212-log-corrupt.sh'^M"
stuff "export OPT_TESTS='t1061-object-envelope-time.sh'^M"

# i386:sh => need to have an active shell for /run/user/$(id -u) to persist
screen -t t:gl:run:gcc45:debian:i386:sh
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "ssh gcc45.fsffrance.org^M"

screen -t t:gl:run:gcc45:debian:i386
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "export OPT_TESTS='t[0-9]*.sh'^M"
stuff "# time OPT_DEBUG= OPT_JOBS=3 OPT_JOB_NAME=gcc45 OPT_REVISION=HEAD OPT_TESTS=\"t[0-9]*.sh\" ~/g/git-gitlab-ci/ci/gitlab/run-on-gcc-farm.sh^M"

# Solaris 10
screen -t t:gl:run:gcc210:SPARC:Solaris10
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "export OPT_TESTS='t[0-9]*.sh'^M"
stuff "# time OPT_DEBUG= OPT_JOBS=4 OPT_JOB_NAME=gcc210 OPT_REVISION=HEAD OPT_TESTS=\"t[0-9]*.sh\" ~/g/git-gitlab-ci/ci/gitlab/run-on-gcc-farm.sh^M"

# Solaris 11
screen -t t:gl:run:gcc211:SPARC:Solaris11
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "export OPT_TESTS='t[0-9]*.sh'^M"
stuff "# time OPT_DEBUG= OPT_JOBS=4 OPT_JOB_NAME=gcc211 OPT_REVISION=HEAD OPT_TESTS=\"t[0-9]*.sh\" ~/g/git-gitlab-ci/ci/gitlab/run-on-gcc-farm.sh^M"

# OpenBSD
screen -t t:gl:run:gcc220:obsd:Xeon
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "export OPT_TESTS='t[0-9]*.sh'^M"
stuff "# time OPT_DEBUG= OPT_JOBS=2 OPT_JOB_NAME=gcc220 OPT_REVISION=HEAD OPT_TESTS=\"t[0-9]*.sh\" ~/g/git-gitlab-ci/ci/gitlab/run-on-gcc-farm.sh^M"

# OpenSUSE aarch64
screen -t t:gl:run:gcc118:SuSE:aarch64:sh:KA
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "ssh gcc118.fsffrance.org^M"

screen -t t:gl:run:gcc118:SuSE:aarch64
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "export OPT_TESTS='t[0-9]*.sh'^M"
stuff "# time OPT_DEBUG= OPT_JOBS=4 OPT_JOB_NAME=gcc118 OPT_REVISION=HEAD OPT_TESTS=\"t[0-9]*.sh\" ~/g/git-gitlab-ci/ci/gitlab/run-on-gcc-farm.sh^M"

# CentOS ppc64le
screen -t t:gl:run:gcc135:COS:ppc64le:sh:KA
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "ssh gcc135.fsffrance.org^M"

screen -t t:gl:run:gcc135:COS:ppc64le
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "export OPT_TESTS='t[0-9]*.sh'^M"
stuff "# time OPT_DEBUG= OPT_JOBS=24 OPT_JOB_NAME=gcc135 OPT_REVISION=HEAD OPT_TESTS=\"t[0-9]*.sh\" ~/g/git-gitlab-ci/ci/gitlab/run-on-gcc-farm.sh^M"

# Debian ppc64
screen -t t:gl:run:gcc203:COS:ppc64le:sh:KA
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "ssh gcc203.fsffrance.org^M"

screen -t t:gl:run:gcc203:Debian:ppc64
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "export OPT_TESTS='t[0-9]*.sh'^M"
stuff "# time OPT_DEBUG= OPT_JOBS=24 OPT_JOB_NAME=gcc203 OPT_REVISION=HEAD OPT_TESTS=\"t[0-9]*.sh\" ~/g/git-gitlab-ci/ci/gitlab/run-on-gcc-farm.sh^M"

# OpenSUSE aarch64
screen -t t:gl:run:gcc22:COS:debian:buster:mips64
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "export OPT_TESTS='t[0-9]*.sh'^M"
stuff "# time OPT_DEBUG= OPT_JOBS=1 OPT_JOB_NAME=gcc22 OPT_REVISION=HEAD OPT_TESTS=\"t[0-9]*.sh\" ~/g/git-gitlab-ci/ci/gitlab/run-on-gcc-farm.sh^M"

# Apple m1 Mac Mini
screen -t t:gl:run:gcc304:OSX:M1
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "export OPT_TESTS='t[0-9]*.sh'^M"
stuff "# time OPT_DEBUG= OPT_JOBS=8 OPT_JOB_NAME=gcc304 OPT_REVISION=HEAD OPT_TESTS=\"t[0-9]*.sh\" ~/g/git-gitlab-ci/ci/gitlab/run-on-gcc-farm.sh^M"

# OpenBSD i7
screen -t t:gl:run:gcc302:obsd:xeon
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "export OPT_TESTS='t[0-9]*.sh'^M"
stuff "# time OPT_DEBUG= OPT_JOBS=1 OPT_JOB_NAME=gcc302 OPT_REVISION=HEAD OPT_TESTS=\"t[0-9]*.sh\" ~/g/git-gitlab-ci/ci/gitlab/run-on-gcc-farm.sh^M"

# NetBSD i7
screen -t t:gl:run:gcc300:nbsd:i7
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "export OPT_TESTS='t[0-9]*.sh'^M"
stuff "# time OPT_DEBUG= OPT_JOBS=1 OPT_JOB_NAME=gcc300 OPT_REVISION=HEAD OPT_TESTS=\"t[0-9]*.sh\" ~/g/git-gitlab-ci/ci/gitlab/run-on-gcc-farm.sh^M"

# FreeBSD i7
screen -t t:gl:run:gcc303:fbsd:i7
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "export OPT_TESTS='t[0-9]*.sh'^M"
stuff "# time OPT_DEBUG= OPT_JOBS=1 OPT_JOB_NAME=gcc303 OPT_REVISION=HEAD OPT_TESTS=\"t[0-9]*.sh\" ~/g/git-gitlab-ci/ci/gitlab/run-on-gcc-farm.sh^M"

# Alpine i7 
screen -t t:gl:run:gcc301:alpine:i7
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "export OPT_TESTS='t[0-9]*.sh'^M"
stuff "# time OPT_DEBUG= OPT_JOBS=1 OPT_JOB_NAME=gcc301 OPT_REVISION=HEAD OPT_TESTS=\"t[0-9]*.sh\" ~/g/git-gitlab-ci/ci/gitlab/run-on-gcc-farm.sh^M"

# HP/UX ia64
screen -t t:gl:run:gcc999:HP/UX:i7
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "# time OPT_DEBUG= OPT_JOBS=1 OPT_JOB_NAME=gcc999 OPT_GCC_HOSTNAME=x2-ext.procura.nl OPT_REVISION=HEAD OPT_TESTS=\"t[0-9]*.sh\" ~/g/git-gitlab-ci/ci/gitlab/run-on-gcc-farm.sh^M"

screen -t t:gl:run:gcc999:HP/UX:sh:0
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "ssh avar@x2-ext.procura.nl^M"
stuff "cat /perl/README^M"

screen -t t:gl:run:gcc999:HP/UX:sh:1
stuff "cd ~/g/git^M"
stuff "git version^M"
stuff "ssh avar@x2-ext.procura.nl^M"
stuff "cat /perl/README^M"

select 0
