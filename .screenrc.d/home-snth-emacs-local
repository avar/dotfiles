source /home/avar/.screenrc

sessionname local

screen -t t bash
stuff "htop^M"

screen -t system:log bash
stuff "tail -F /var/log/{syslog,messages,auth.log,user.log,daemon.log,aptitude,kern.log,dpkg.log}^M"

screen -t m:avar:l bash
stuff "tail -F /var/mail/avar^M"

screen -t m:exim:l bash
stuff "tail -F /var/log/exim4/mainlog^M"

screen -t m:exim:q bash
# Shows the status of the exim mail queue, i.e. any stalled messages
stuff "sudo exim -bp^M"
# Shows a summary
stuff "sudo exim -bp | sudo exiqsumm^M"
# What's exim doing?
stuff "sudo exiwhat^M"
# Forces sending of the messages, if any. See
# http://www.electrictoolbox.com/flush-exim-mail-queue/
# http://mewbies.com/how_to_setup_exim_mail_transfer_agent_for_linux_tutorial.htm
# also: http://bradthemad.org/tech/notes/exim_cheatsheet.php
# to remove messages: https://www.cyberciti.biz/faq/exim-remove-all-messages-from-the-mail-queue/
# --> sudo exim -bp | awk '/^ *[0-9]+[mhd]/{print "sudo exim -Mrm " $3}'|sh
stuff "# sudo exim -qf # send stalled messages^M"
stuff "# sudo exim -qff # send stalled messages, even if frozen due to bounces^M"

# Work GMail setup
screen -t m:wg:md:size bash
stuff "du -sb ~/.mu ~/Maildir/work-gmail; du -sh ~/.mu ~/Maildir/work-gmail; find ~/Maildir/work-gmail/ -type f | wc -l; df -h /^M"

screen -t m:wg:md:find bash
stuff "find ~/Maildir/work-gmail -type f -mmin -5|wc -l # modified in the last 5mins^M"
stuff "find ~/Maildir/work-gmail -type f -cmin -5|wc -l # created in the last 5mins^M"

screen -t m:wg:stunnel bash
stuff "# (stunnel .stunnel.work-gmail-imap || (kill \$(sudo netstat -ldnp|grep -F 127.0.0.1:1431|awk '{print \$7}'|awk -F/ '{print \$1}')) && echo Restarting && sleep 1 && stunnel .stunnel.work-gmail-imap)^M"

screen -t m:wg:stunnel:flow bash
stuff "# sudo tcpflow -i lo -c port 1431 | grep -i -e \^subject -e \^list-id -e \^from -e \^date^M"

screen -t m:wg:sync:<> bash
stuff "sleep 10^M"
# debug: -d imap,maildir
stuff "while true; do time offlineimap -a WorkGMail,PersonalGMail -c ~/.offlineimaprc ; sleep 60; done^M"

# Personal GMail setup
screen -t m:pg:md:size bash
stuff "du -sb ~/.mu ~/Maildir/personal-gmail; du -sh ~/.mu ~/Maildir/personal-gmail; find ~/Maildir/personal-gmail/ -type f | wc -l; df -h /^M"

screen -t m:pg:md:find bash
stuff "find ~/Maildir/personal-gmail -type f -mmin -5|wc -l # modified in the last 5mins^M"
stuff "find ~/Maildir/personal-gmail -type f -cmin -5|wc -l # created in the last 5mins^M"

screen -t m:pg:stunnel bash
stuff "# (stunnel .stunnel.personal-gmail-imap || (kill \$(sudo netstat -ldnp|grep -F 127.0.0.1:1430|awk '{print \$7}'|awk -F/ '{print \$1}')) && echo Restarting && sleep 1 && stunnel .stunnel.personal-gmail-imap)^M"

screen -t m:pg:stunnel:flow bash
stuff "# sudo tcpflow -i lo -c port 1430 | grep -i -e \^subject -e \^list-id -e \^from -e \^date^M"

screen -t m:pg:sync:<> bash
stuff "sleep 10^M"
# debug: -d imap,maildir
#stuff "while true; time offlineimap -a PersonalGMail -c ~/.offlineimaprc ; sleep 60; done^M"
stuff "# time offlineimap -a PersonalGMail -c ~/.offlineimaprc^M"

# mu
screen -t m:monitor bash
stuff "# while sleep 1; do time sudo perl ~/g/dotemacs/scripts/mu-monitor.pl; done^M"

screen -t m:index bash
stuff "# time mu index --muhome=/home/avar/.mu/work-exchange --maildir=~/Maildir/work --max-msg-size=500000000^M"
stuff "# time mu index --muhome=/home/avar/.mu/work-gmail --maildir=~/Maildir/work-gmail --max-msg-size=500000000^M"
stuff "# time mu index --muhome=/home/avar/.mu/personal-gmail --maildir=~/Maildir/personal-gmail --max-msg-size=500000000^M"

screen -t m:wrk:f:0 bash
stuff "export MU_HOME=/home/avar/.mu/work-gmail^M"
stuff "export MAILDIR=/home/avar/Maildir/work-gmail^M"
stuff "mu find -n 10 avar^M"

screen -t m:wrk:f:1 bash
stuff "export MU_HOME=/home/avar/.mu/work-gmail^M"
stuff "export MAILDIR=/home/avar/Maildir/work-gmail^M"
stuff "mu find -n 10 booking^M"

screen -t m:prsnl:f:0 bash
stuff "export MU_HOME=/home/avar/.mu/personal-gmail^M"
stuff "export MAILDIR=/home/avar/Maildir/personal-gmail^M"
stuff "mu find -n 10 avar^M"

screen -t m:prsnl:f:1 bash
stuff "export MU_HOME=/home/avar/.mu/personal-gmail^M"
stuff "export MAILDIR=/home/avar/Maildir/personal-gmail^M"
stuff "mu find -n 10 booking^M"

# logs
screen -t s:daemon-nm-dis:l bash
stuff "tail -f /var/log/daemon.log | grep nm-dispatcher^M"

screen -t s:squid:l bash
stuff "sudo tail -F /var/log/squid{,3,4}/*.log^M"

# OpenVPN related
screen -t yubikey:hook bash
stuff "tail -n 0 -F /tmp/udev.70-youbikey-setxkbmap.hook | DISPLAY=:0 perl -nE 'sleep 1; chomp(my \$device = qx[xinput list | sed -n \"s/.*Yubikey.*id=\\\\([0-9]*\\\\).*keyboard.*/\\\\1/p\"]); unless (\$device) { say STDERR qq[Could not find device id (lagging, or plugged out?] } else { say qq[Setting device \$device to us! <] . qx[setxkbmap -device \$device -layout us 2>&1] . qq[>] }'^M"

screen -t openvpn:connect bash
stuff "nmcli con up id 'booking'"

screen -t openvpn.log bash
stuff "tail -f /var/log/syslog /var/log/daemon.log | grep openvpn^M"

screen -t nm-dispatcher.log bash
stuff "tail -f /var/log/syslog /var/log/daemon.log | grep nm-dispatcher^M"

screen -t tcpflow:openvpn bash
stuff "sudo tcpflow -i wlan0 -c port 1194"

screen -t investigate bash
stuff "ip route list^M"
stuff "ip route get 10.252.13.1^M"
stuff "ip route get 8.8.8.8^M"

# The m:sync screen
select 9
